<?php
$this->data['header'] = $this->t('{ldapandyubi:administrator:header}');
$this->data['jquery'] = '1.6';
$this->data['head'] = '<link rel="stylesheet" type="text/css" href="/'. $this->data['baseurlpath'] .'module.php/ldapandyubi/resources/ldapandyubi.css" />' ;

$settings = $this->data['settings'];

$this->includeAtTemplateBase('includes/header.php');
?>

<?php
if ($this->data['errorcode'] !== NULL) {
?>
	<div style="border-left: 1px solid #e8e8e8; border-bottom: 1px solid #e8e8e8; background: #f5f5f5">
		<img src="/<?php echo $this->data['baseurlpath']; ?>resources/icons/experience/gtk-dialog-error.48x48.png" style="float: left; margin: 15px " />
		<h2><?php echo $this->t('{login:error_header}'); ?></h2>
B
		<p><b><?php echo $this->t('{errors:title_' . $this->data['errorcode'] . '}'); ?></b></p>
		<p><?php echo $this->t('{errors:descr_' . $this->data['errorcode'] . '}'); ?></p>
	</div>
<?php
}
?>

	<h2 style=""><?php echo $this->t('{ldapandyubi:administrator:header}'); ?></h2>

	<?php echo $this->t('{ldapandyubi:administrator:intro}'); ?>
<p>
Kétfaktoros azonosítás állapotok:
</p>
<?php foreach($settings["status"] as $uid => $enabled ):?>
<p>
<?= $uid?>: 
<?= $enabled?"<font color=\"green\">ON</font>":"<font color=\"red\">OFF</font>" ?>
 <a href="administrator.php?<?php echo $enabled?"dis":"en"  ?>able=1&uid=<?= $uid ?>"><input type="submit" value="<?= $enabled?"Letiltás!":"Engedélyezés!" ?>
"></a>
</p>
<?php endforeach ?>

<p>
Regisztrált yubi kulcsok: 
</p>
<?php foreach ($settings['yubi_id'] as $row) :?>
<p>
<?php echo $row['uid'] ."=>". $row['yubikey'] ?>
 <a href="administrator.php?deleteYubikey=<?php echo $row['yubikey'] ?>&uid=<?php echo $row['uid'] ?>"><input type="button" value="Törlés"></a>
</p>
<?php endforeach ?>
<input id="registerYubikey" type="button" value="Új Yubikey regisztrálása!">
<div id="registerForm">
 <form name="registerYubikey" action="" method="POST">
 uid: <input name="uid">
 <input name="registerYubikey" value="Nyomj ide egy OTP-t!">
 <br>
 <input type="submit">
 </form>
</div>


<p style="display: none;">
Biztonsági egyszer használatos ellenőrző kódok
<span id="clickme" style="cursor: pointer;">
&downarrow;
</span>
</p>
<div id="potp" style="display: none;">
<table border="1px">
<?php foreach ($settings['potp'] as $p) :?>
<?php if ($i%3 == 0) echo "<tr>" ?>
<td>
<?php echo chunk_split($p,3," ") ?>
</td>
<?php if (($i-2)%3 == 0) echo "</tr>" ?>
<?php $i++ ?>
<?php endforeach ?>
</table>

<input type="submit" value="Új kódok generálása!">

</div>

<div>
<a href="administrator.php?logout=1"><input type="button" value="Kilépés"></a>
</div>

<?php

$this->includeAtTemplateBase('includes/footer.php');
?>
<script>
$(document).ready(function() {
    $('#registerForm').dialog({
          overlay: { opacity: 0.5, background: 'black'},
          modal:true,
          autoOpen: false
          });
  $('#registerYubikey').click(function() {
     $('#registerForm').dialog("open");
  });
  $('#clickme').click(function() {
    $('#potp').toggle('slow', function() {
      // Animation complete.
    });
  });
});
</script>
