<?php
$this->data['header'] = $this->t('{login:user_pass_header}');
$this->data['autofocus'] = 'otp';
$this->data['jquery'] = '1.6';
$this->data['head'] = '<link rel="stylesheet" type="text/css" href="/'. $this->data['baseurlpath'] .'module.php/ldapandyubi/resources/ldapandyubi.css" />' ;

$this->includeAtTemplateBase('includes/header.php');

?>

<?php
if ($this->data['errorcode'] !== NULL) {
?>
	<div style="border-left: 1px solid #e8e8e8; border-bottom: 1px solid #e8e8e8; background: #f5f5f5">
		<img src="/<?php echo $this->data['baseurlpath']; ?>resources/icons/experience/gtk-dialog-error.48x48.png" style="float: left; margin: 15px " />
		<h2><?php echo $this->t('{login:error_header}'); ?></h2>
		<p><b><?php echo $this->t('{ldapandyubi:errors:title_' . $this->data['errorcode'] . '}'); ?></b></p>
		<p><?php echo $this->t('{ldapandyubi:errors:descr_' . $this->data['errorcode'] . '}'); ?></p>
	</div>
<?php
}
?>

        <?php if ($this->data['goToSettings']) : ?>
	   <h2 style=""><?php echo $this->t('{ldapandyubi:login:gotosettings_header}'); ?></h2>
	   <p><?php echo $this->t('{ldapandyubi:login:gotosettings_text}'); ?></p>
        <?php else : ?>
	   <h2 style=""><?php echo $this->t('{login:user_pass_header}'); ?></h2>
	   <p><?php echo $this->t('{login:user_pass_text}'); ?></p>
        <?php endif ?>

	<form action="?" method="post" name="f" id="form">

	
                <div class="loginbox">
		<p class="logintitle"><?php echo $this->t('{ldapandyubi:login:otpfield}'); ?>
                </p>
                <p>
		<input id="otp" class="yubifield" type="text" tabindex="2" name="otp" />
                </p>
                <p class="logintitle">
		<?php echo $this->t('{login:password}'); ?>
                </p>
                <p>
		<input id="pass" class="passwordfield" type="password" tabindex="2" name="password" />
                </p>
                <p>
		<input id="submit" class="submitbutton" type="submit" tabindex="2" name="submit" value="<?php echo $this->t('{login:login_button}')?>"/>
                </p>
                <?php // amig nincs bejelentes if (!$this->data['goToSettings']) : ?>
                <?php if (FALSE) : ?>
                <p style="clear: both;">
                   <a href="settings.php"><?php echo $this->t('{ldapandyubi:login:settings}')?></a>
                </p>
                <?php endif ?>
                </div>

<?php
foreach ($this->data['stateparams'] as $name => $value) {
	echo('<input type="hidden" name="' . htmlspecialchars($name) . '" value="' . htmlspecialchars($value) . '" />');
}
?>

	</form>
<div id="go" >
<?php echo $this->t('{ldapandyubi:login:yubi1falogininprogress}'); ?>
</div>

<?php

$this->includeAtTemplateBase('includes/footer.php');
?>
<script>
$(document).ready(function() {
  $("#go").dialog( {modal: true , autoOpen: false});
/*  $("#go").dialog({ autoOpen: false });*/
  $("#otp").bind("keydown", function(event) {
    if (event.which === 13 || event.which === 9) {
        event.stopPropagation();
        event.preventDefault();
        $.post('isYubiAnd1f.php', $("#otp").serialize(), function(data)  {
          if ( data == 'YES' )
          {
             $("#go").dialog("open");
             $("#submit").click();
          }
        });
        $("#pass").focus();
    }
  });
});
</script>
